(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[898],{42480:function(){},5129:function(t,e,s){Promise.resolve().then(s.t.bind(s,65878,23)),Promise.resolve().then(s.bind(s,81523)),Promise.resolve().then(s.bind(s,70049)),Promise.resolve().then(s.bind(s,41180))},41180:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return k}});var o=s(57437),i=s(2265),a=s(78796),r=s(61507),l=s(6314),n=s(32817),c=s(34442),d=s(25810),u=s(307),p=s(29501),_=s(71096),m=s.n(_),v=s(80605),g=s(89427),h=s(82645),f=s(99376),b=s(25957),x=s(65594),y=s(43118),j=s(83930);function k(){let{data:t}=(0,v.useSession)(),[e,s]=i.useState(!1),[_,k]=i.useState(!1),[S,C]=i.useState(),{dataPost:z,setDataPost:E,setStatusSave:Y}=(0,j.k)(),{setIsModalMedia:w,isOpenFeatureImage:A,openFeatureImage:D,closeFeatureImage:q,setSeletectedImage:M,closeMedia:N,seletectedImage:P,setFocalPoint:H,focalPoint:I,setGallery:T}=(0,b.G)(),Z=(0,f.useRouter)(),{register:B,handleSubmit:F,formState:{errors:U},setValue:G,control:O,trigger:R,reset:L,watch:V,getValues:Q}=(0,p.cI)(),X=(0,p.qo)({control:O,name:"post_title"}),J=(0,a.p)(),K=(0,f.useSearchParams)(),W=(0,y.A)(K.get("aa"))||"",$=async e=>{var o,i,a;s(!0),e.post_date=null==z?void 0:z.post_date,e.post_publish_date="scheduled"===e.post_status?m()(e.post_publish_date).format("YYYY-MM-DD HH:mm:ss"):null==z?void 0:z.post_publish_date,e.post_original_date=null==z?void 0:z.post_original_date,e.post_status=[e.post_status],e.post_author=null==z?void 0:z.post_author,e.post_tag=e.post_tag.map(t=>t.label),e.is_premium=0,e.partner_id=1,e.post_video_url="",e.post_gallery=e.post_gallery||[],e.post_modified=m()().format("YYYY-MM-DD HH:mm:ss"),e.feat_img_size={small:{x:null==I?void 0:I.x.toString(),y:null==I?void 0:I.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},e.post_editor=null==z?void 0:z.post_editor,e.post_source=0,e.post_canonical_link="",e.is_ghost=0,e.post_enclosure_link="",e.post_title_masking="",e.contributor=e.contributor||"",e.contributor_id="";let r=await (0,g.Z)("PUT","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(W),e,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(o=t.user)||void 0===o?void 0:o.access_token)});(null==r?void 0:r.status)==200?(await (0,g.Z)("GET","".concat("https://mercury.uzone.id/","api/v1/articles/close-editor"),{article_id:W},{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(i=t.user)||void 0===i?void 0:i.access_token)}),s(!1),J({title:"Success",description:"Data has been updated",status:"success",duration:6e3,isClosable:!0,position:"top"}),"publish"==e.post_status?Z.push("/dashboard/post/list"):Z.push("/dashboard/post/draft")):(null==r?void 0:r.status)==403?(s(!1),J({title:"Error",description:null==r?void 0:null===(a=r.data)||void 0===a?void 0:a.message,status:"error",duration:6e3,isClosable:!0,position:"top"})):(s(!1),J({title:"Failed to create data",description:r.data.detail.map(t=>"".concat(t.loc.join(" -> "),": ").concat(t.msg)).join(", "),status:"error",duration:7e3,isClosable:!0,position:"top"}))},tt=async()=>{var e,s;let o=Q();Y("saving"),o.post_date=null==z?void 0:z.post_date,o.post_publish_date="scheduled"===o.post_status?m()(o.post_publish_date).format("YYYY-MM-DD HH:mm:ss"):null==z?void 0:z.post_publish_date,o.post_original_date=null==z?void 0:z.post_original_date,o.post_status=["draft"],o.post_author="".concat(t.user.first_name," ").concat(t.user.last_name),o.post_tag=(null===(e=o.post_tag)||void 0===e?void 0:e.map(t=>t.label))||[],o.is_premium=0,o.partner_id=1,o.post_video_url=o.post_video_url||"",o.post_gallery=o.post_gallery||[],o.post_modified=m()().format("YYYY-MM-DD HH:mm:ss"),o.feat_img_size={small:{x:null==I?void 0:I.x.toString(),y:null==I?void 0:I.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},o.post_editor=0,o.post_source=0,o.post_canonical_link="",o.is_ghost=0,o.post_enclosure_link="",o.post_title_masking="",o.post_images_title=o.post_images_title||"",o.feature_img=o.feature_img||"",o.contributor=o.contributor||"",o.contributor_id="",await (0,g.Z)("PUT","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(z.id),o,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.access_token)}),Y("saved")};B("post_content",{required:"Content is required"}),B("post_tag",{required:"Tag is required"}),B("post_category",{required:"Category is required"}),B("post_publisher",{required:"publish on is required"}),i.useEffect(()=>{X&&G("post_slug",X.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""))},[X,G]),i.useEffect(()=>{let e=async()=>{var e,s,o;let i=await (0,g.Z)("GET","".concat("https://mercury.uzone.id/","api/v1/articles/"),{id:W},{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.access_token)});if((null==i?void 0:i.status)==200){let t=null==i?void 0:null===(s=i.data)||void 0===s?void 0:s.data;t.post_publisher=Array.isArray(t.post_publisher)?[...t.post_publisher,"1"]:["1"],M(null==t?void 0:t.feature_img),H(null==t?void 0:null===(o=t.feat_img_size)||void 0===o?void 0:o.small),T(null==t?void 0:t.post_gallery),E(t),L(t)}else(null==i?void 0:i.status)==400&&(k(!0),C(null==i?void 0:i.data))};t&&e()},[t]),i.useEffect(()=>(q(),N(),()=>{Y("")}),[]);let te=async()=>{var e;let s=await (0,g.Z)("GET","".concat("https://mercury.uzone.id/","api/v1/articles/close-editor"),{article_id:W},{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.access_token)});(null==s?void 0:s.status)==200&&Z.back()};return(0,o.jsxs)("div",{className:"px-4 pt-6",children:[(0,o.jsx)(h.Z,{register:B,isOpen:A,onClose:q,setValue:G}),_?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(r.b,{status:"error",children:[(0,o.jsx)(l.z,{}),(0,o.jsx)(n.C,{children:"Error"}),(0,o.jsx)(c.X,{children:null==S?void 0:S.message})]}),(0,o.jsx)("div",{className:"flex justify-center",children:(0,o.jsx)(d.z,{mt:5,colorScheme:"teal",onClick:()=>Z.back(),children:"Back"})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-4 lg:mb-2",children:[(0,o.jsx)("h3",{className:"mb-2 text-xl font-bold text-gray-900 dark:text-white",children:"Edit Post"}),(0,o.jsx)(d.z,{colorScheme:"red",onClick:te,children:"Cancel Edit"})]}),(0,o.jsx)("div",{className:"",children:(0,o.jsx)("form",{onSubmit:F($),autoComplete:"off",className:"grid grid-cols-1 gap-2 lg:grid-cols-3",children:z?(0,o.jsx)(x.Z,{register:B,errors:U,session:t,control:O,trigger:R,setValue:G,isLoading:e,setIsModalMedia:w,openFeatureImage:D,seletectedImage:P,Controller:p.Qr,watch:V,useFieldArray:p.Dq,saveContentToDraft:tt}):(0,o.jsx)(u.E,{size:"xs",className:"lg:col-span-3",isIndeterminate:!0})})})]})]})}},43118:function(t,e,s){"use strict";s.d(e,{A:function(){return r},P:function(){return a}});var o=s(80928),i=s.n(o);function a(t){return encodeURIComponent(i().AES.encrypt(t.toString(),"c2c9cfa669c5a7fd065c694e3c112f1aec09401e895ad77f72255158b9847d58").toString())}function r(t){return i().AES.decrypt(decodeURIComponent(t),"c2c9cfa669c5a7fd065c694e3c112f1aec09401e895ad77f72255158b9847d58").toString(i().enc.Utf8)}}},function(t){t.O(0,[4565,7360,7699,1544,6051,5706,9956,1779,7240,2156,296,9439,5878,9293,605,1760,9799,3464,9501,9611,7198,9395,9614,6530,674,1324,7417,1086,2971,2117,1744],function(){return t(t.s=5129)}),_N_E=t.O()}]);