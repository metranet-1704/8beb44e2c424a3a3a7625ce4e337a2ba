(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[898],{42480:function(){},5129:function(t,e,o){Promise.resolve().then(o.t.bind(o,65878,23)),Promise.resolve().then(o.bind(o,81523)),Promise.resolve().then(o.bind(o,70049)),Promise.resolve().then(o.bind(o,41180))},41180:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return v}});var s=o(57437),i=o(2265),a=o(78796),r=o(29501),n=o(71096),l=o.n(n),c=o(80605),u=o(89427),d=o(82645),p=o(99376),_=o(25957),m=o(65594),f=o(43118),g=o(83930);function v(){let{data:t}=(0,c.useSession)(),[e,o]=i.useState(!1),{dataPost:n,setDataPost:v,setStatusSave:h}=(0,g.k)(),{setIsModalMedia:b,isOpenFeatureImage:y,openFeatureImage:x,closeFeatureImage:Y,setSeletectedImage:k,closeMedia:S,seletectedImage:j,setFocalPoint:C,focalPoint:D,setGallery:M}=(0,_.G)(),q=(0,p.useRouter)(),{register:E,handleSubmit:H,formState:{errors:w},setValue:z,control:N,trigger:P,reset:A,watch:I,getValues:T}=(0,r.cI)(),U=(0,r.qo)({control:N,name:"post_title"}),Z=(0,a.p)(),B=(0,p.useSearchParams)(),F=(0,f.A)(B.get("aa"))||"",L=async e=>{var s;o(!0),e.post_date=l()().format("YYYY-MM-DD HH:mm:ss"),e.post_publish_date="1970-01-01 23:59:59",e.post_original_date=l()().format("YYYY-MM-DD HH:mm:ss"),e.post_status=[e.post_status],e.post_author=t.user.username,e.post_tag=e.post_tag.map(t=>t.label),e.is_premium=0,e.partner_id=1,e.post_video_url="",e.post_gallery=e.post_gallery||[],e.post_modified="",e.feat_img_size={small:{x:null==D?void 0:D.x.toString(),y:null==D?void 0:D.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},e.post_editor=null==n?void 0:n.post_editor,e.post_source=0,e.post_canonical_link="",e.is_ghost=0,e.post_enclosure_link="",e.post_title_masking="",e.contributor=e.contributor||"",e.contributor_id="";let i=await (0,u.Z)("PUT","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(F),e,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.access_token)});(null==i?void 0:i.status)==200?(o(!1),Z({title:"Success",description:"Data has been updated",status:"success",duration:6e3,isClosable:!0,position:"top"}),"publish"==e.post_status?q.push("/dashboard/post/list"):q.push("/dashboard/post/draft")):(o(!1),Z({title:"Failed to create data",description:i.data.detail.map(t=>"".concat(t.loc.join(" -> "),": ").concat(t.msg)).join(", "),status:"error",duration:7e3,isClosable:!0,position:"top"}))},O=async()=>{var e,o;let s=T();h("saving"),s.post_date=l()().format("YYYY-MM-DD HH:mm:ss"),s.post_publish_date="1970-01-01 23:59:59",s.post_original_date=l()().format("YYYY-MM-DD HH:mm:ss"),s.post_status=["draft"],s.post_author=t.user.username,s.post_tag=(null===(e=s.post_tag)||void 0===e?void 0:e.map(t=>t.label))||[],s.is_premium=0,s.partner_id=1,s.post_video_url=s.post_video_url||"",s.post_gallery=s.post_gallery||[],s.post_modified=l()().format("YYYY-MM-DD HH:mm:ss"),s.feat_img_size={small:{x:null==D?void 0:D.x.toString(),y:null==D?void 0:D.y.toString()},medium:{x:"",y:""},full:{x:"",y:""}},s.post_editor=0,s.post_source=0,s.post_canonical_link="",s.is_ghost=0,s.post_enclosure_link="",s.post_title_masking="",s.post_images_title=s.post_images_title||"",s.feature_img=s.feature_img||"",s.contributor=s.contributor||"",s.contributor_id="",await (0,u.Z)("PUT","".concat("https://mercury.uzone.id/","api/v1/articles/?article_id=").concat(n.id),s,{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(o=t.user)||void 0===o?void 0:o.access_token)}),h("saved")};return E("post_content",{required:"Content is required"}),E("post_tag",{required:"Tag is required"}),E("post_category",{required:"Category is required"}),E("post_publisher",{required:"publish on is required"}),i.useEffect(()=>{U&&z("post_slug",U.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""))},[U,z]),i.useEffect(()=>{let e=async()=>{var e,o,s;let i=await (0,u.Z)("GET","".concat("https://mercury.uzone.id/","api/v1/articles/"),{id:F},{accept:"application/json",Authorization:"Bearer ".concat(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.access_token)});if((null==i?void 0:i.status)==200){let t=null==i?void 0:null===(o=i.data)||void 0===o?void 0:o.data;t.post_publisher=[...t.post_publisher,"1"],k(null==t?void 0:t.feature_img),C(null==t?void 0:null===(s=t.feat_img_size)||void 0===s?void 0:s.small),M(null==t?void 0:t.post_gallery),v(t),A(t)}};t&&e()},[t]),i.useEffect(()=>(Y(),S(),()=>{h("")}),[]),(0,s.jsxs)("div",{className:"px-4 pt-6",children:[(0,s.jsx)(d.Z,{register:E,isOpen:y,onClose:Y,setValue:z}),(0,s.jsx)("div",{className:"flex items-center mb-4 lg:mb-0",children:(0,s.jsx)("h3",{className:"mb-2 text-xl font-bold text-gray-900 dark:text-white",children:"Edit Post"})}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)("form",{onSubmit:H(L),autoComplete:"off",className:"grid grid-cols-1 gap-2 lg:grid-cols-3",children:n?(0,s.jsx)(m.Z,{register:E,errors:w,session:t,control:N,trigger:P,setValue:z,isLoading:e,setIsModalMedia:b,openFeatureImage:x,seletectedImage:j,Controller:r.Qr,watch:I,useFieldArray:r.Dq,saveContentToDraft:O}):(0,s.jsx)("div",{className:"flex justify-center",children:"Loading..."})})})]})}},43118:function(t,e,o){"use strict";o.d(e,{A:function(){return r},P:function(){return a}});var s=o(80928),i=o.n(s);function a(t){return encodeURIComponent(i().AES.encrypt(t.toString(),"c2c9cfa669c5a7fd065c694e3c112f1aec09401e895ad77f72255158b9847d58").toString())}function r(t){return i().AES.decrypt(decodeURIComponent(t),"c2c9cfa669c5a7fd065c694e3c112f1aec09401e895ad77f72255158b9847d58").toString(i().enc.Utf8)}}},function(t){t.O(0,[4565,7699,6051,9956,1779,7240,5706,296,9701,5878,605,3015,1760,9799,3464,9355,9611,1612,5506,2868,316,2228,9378,1086,2971,2117,1744],function(){return t(t.s=5129)}),_N_E=t.O()}]);